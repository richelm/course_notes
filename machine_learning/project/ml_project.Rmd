---
title: "Machine Learning Project"
author: "Shawn Rich"
date: "May 7, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r warning=FALSE, echo=FALSE, error=FALSE, message=FALSE}
# initializations
rm(list=ls())

# set working directory
setwd("~/Documents/courses/course_notes/machine_learning/project")

# load libraries
library(caret)

```

## Load Train and Test Data

```{r warning=FALSE, echo=FALSE, error=FALSE, message=FALSE}
trainingData <- read.table("./data/pml-training.csv", sep=",", na.strings = c("NA","#DIV/0!"),header = TRUE)
testingData <- read.table("./data/pml-testing.csv", sep=",", na.strings = c("NA","#DIV/0!"),header = TRUE)
```

## Cleanup Data

The first two columns "X" and "user_name" and timestamps variables are removed as they are irrelevant as predictors. The data contain many NA values. These are set to zero. Next the caret function nearZeroVar is used to identify near zero-variance variables that we would want to eliminate as predictors in our model.

```{r warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
#trainingData <- trainingData[,-grep( "timestamp|X|user_name|num_window" , names(trainingData))]
trainingData <- trainingData[,grep( "classe|roll|pitch|yaw" , names(trainingData))]
trainingData[is.na(trainingData)] <- 0
nzv <- nearZeroVar(trainingData)
trainingData <- trainingData[,-nzv]
colnames(trainingData)
```

Next the cleaned up training data is use to create training and testing data sets used for model building and verifying.

```{r warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
set.seed(526)
inTrain <- createDataPartition(trainingData$classe, p=0.75, list=FALSE)
training <- trainingData[inTrain,]
testing <- trainingData[-inTrain,]
```

```{r}
rfFit <- randomForest(classe~., data = training)
#rfFit <- train(classe~., method="rf", data = training)
rfPredict <- predict(rfFit, newdata = testing)
confusionMatrix(data=rfPredict, testing$classe)$overall['Accuracy']
round(importance(rfFit),2)
```

```{r}
treeFit <- train(classe~., data = training, method = "rpart")
treePredict <- predict(treeFit, newdata = testing)
confusionMatrix(data=treePredict, testing$classe)$overall['Accuracy']
```

```{r}
gbmCtrl <- trainControl(method = "cv", number = 5, savePredictions = TRUE)
gbmFit <- train(classe~., data = training, method = "gbm", trControl=gbmCtrl)
gbmPredict <- predict(gbmFit, newdata = testing)
confusionMatrix(data=gbmPredict, testing$classe)$overall['Accuracy']
```

